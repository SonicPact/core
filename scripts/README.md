# SonicPact Scripts

This directory contains utility scripts for the SonicPact project.

## Update IDL Script

The `update-idl.js` and `update-idl.ts` scripts synchronize the IDL (Interface Description Language) from the Anchor-generated JSON file to TypeScript files in the app directory.

### Usage

From the root directory of the project, run:

```bash
# Using JavaScript version
npm run update-idl

# Using TypeScript version
npm run update-idl:ts
```

Or from the app directory:

```bash
# Update IDL only
npm run update-idl

# Build the program and update IDL in one step
npm run sync-idl
```

### What it does

1. Reads the IDL JSON file from `target/idl/sonicpact.json` (generated by Anchor)
2. Converts it to a TypeScript export
3. Writes it to:
   - `app/src/shared/utils/idl/sonicpact.ts`
   - `app/src/utils/idl/sonicpact.ts`

### When to use

Run this script:
- After making changes to the Anchor program and building it
- Before deploying the frontend app
- When you notice discrepancies between the contract and the frontend

### Troubleshooting

If you get an error "Target IDL file not found", make sure you've built the Anchor program with:

```bash
anchor build
```

Then run the update-idl script.

## NFT Metadata Scripts

The project includes two scripts for working with NFT metadata:

1. `generate-nft-metadata.ts` - Generates sample NFT metadata for deals
2. `upload-nft-metadata.ts` - Demonstrates how metadata would be uploaded to Arweave (mocked)

### Usage

From the root directory of the project, run:

```bash
# Generate sample NFT metadata
npm run generate-nft-metadata

# Upload metadata to mock Arweave
npm run upload-nft-metadata
```

Or from the app directory:

```bash
npm run generate-nft-metadata
npm run upload-nft-metadata
```

### What they do

1. **generate-nft-metadata.ts**:
   - Defines the NFT metadata structure according to Metaplex standards
   - Creates sample metadata for a deal
   - Saves it to `app/public/metadata/[deal-id].json`

2. **upload-nft-metadata.ts**:
   - Demonstrates how you would upload metadata to Arweave in a production setting
   - Creates mock transaction IDs for demonstration
   - Saves a mapping of deal IDs to metadata URLs in `app/src/utils/nft/metadata-urls.json`

### When to use

- During testing to generate sample NFT metadata
- To understand the upload process before implementing real Arweave integration
- To test the NFT display in the app with local metadata

### Implementation Notes

In a production environment, you would:
1. Use a real Arweave client (`arweave` npm package)
2. Use proper wallet management for signing transactions
3. Store the transaction IDs in your database
4. Implement proper error handling and retry logic